FUNCTION FINDFIRST$(FS$)
	FS$=FS$+CHR$(0)
	REG %DX,STRPTR(FS$)
	REG %DS,STRSEG(FS$)
	REG %AX,&H4E00
	REG %CX,&H10
	CALL INTERRUPT &H21
	CARRY=(REG(%FLAGS) AND 1)
	IF (CARRY=0) THEN
		FINDFIRST$=BUILDNAME$
	ELSE
		FINDFIRST$=""
	END IF
END FUNCTION
:
FUNCTION FINDNEXT$
	REG %AX,&H4F00
	CALL INTERRUPT &H21
	CARRY=(REG(%FLAGS) AND 1)
	IF (CARRY=0) THEN
		FINDNEXT$=BUILDNAME$
	ELSE
		FINNEXT$=""
	END IF
END FUNCTION
:
FUNCTION BUILDNAME$
	SHARED SubD,DTA$
	EOS=INSTR(31,DTA$,CHR$(0))
	TN$=MID$(DTA$,27,EOS-27)
	IF ASC(MID$(DTA$,22,1))=16 THEN
		Subd=%TRUE
	ELSE
		Subd=%FALSE
	END IF
	BUILDNAME$=TN$
END FUNCTION
:
SUB SETDTA(DTA$)
	REG %DX,STRPTR(DTA$)
	REG %DS,STRSEG(DTA$)
	REG %AX,&H1A00
	CALL INTERRUPT &H21
END SUB
:
FUNCTION EXIST(Path$,NM$,Attr)
	Path$=RTRIM$(Path$,"\")
	IF ASCII(NM$)<32 THEN EXIST=%FALSE:EXIT FUNCTION
	F$=DIR$(Path$+"\"+NM$,Attr)
	IF F$="" THEN EXIST=%FALSE:EXIT FUNCTION
	IF F$=NM$ THEN EXIST=%TRUE:EXIT FUNCTION
	IF F$<>"" THEN	EXIST=%TRUE
END FUNCTION
:
FUNCTION FREESPACE&(Drive$)
	REG %DX,ASCII(Drive$)-64
	REG %AX,&H3600
	CALL INTERRUPT &H21
	FREESPACE&=CQUD(REG(%BX))*REG(%CX)*REG(%AX)
END FUNCTION
:
FUNCTION OKDIR(Path$)
	LOCAL P1
	P2=1
	Path$=RTRIM$(UCASE$(Path$),"\")
	P=ASCII(Path$)-64
	REG %AX,&H0E00
	REG %DX,26
	CALL INTERRUPT &H21
	NoOfDrives=REG(%AX) MOD 256
	IF P<=0 OR P>NoOfDrives THEN
		OKDIR=%FALSE
	ELSEIF INSTR(Path$,"\")=0 THEN
		OKDIR=%TRUE
	ELSE
		SubLevs=TALLY(Path$,"\")
		InSub$=Left$(Path$,2)+"\"
		FOR N=1 TO SubLevs
			P1=INSTR(P2,Path$,"\")
			P2=INSTR(P1+1,Path$,"\")
			IF P2=0 THEN
				Subd$=RIGHT$(Path$,LEN(Path$)-P1)
			ELSE
				SubD$=MID$(Path$,P1+1,(P2-1)-P1)
			END IF
			IF N=SubLevs THEN
				IF EXIST(InSub$,SubD$,0) THEN
					OKDIR=1:EXIT FOR
				ELSEIF EXIST(InSub$,SubD$,16) THEN
					OKDIR=%TRUE:EXIT FOR
				ELSE
					OKDIR=%FALSE:EXIT FOR
				END IF
			ELSE
				IF NOT EXIST(InSub$,SubD$,16) THEN
					OKDIR=%FALSE:EXIT FOR
				END IF
			END IF
			InSub$=InSub$+"\"+SubD$
			P1=P2
		NEXT N
	END IF
END FUNCTION
